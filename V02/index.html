<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BCFSleuth - BCF File Analyzer</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <header>
      <div class="container">
        <div class="header-content">
          <div class="header-text">
            <h1>BCFSleuth</h1>
            <p class="tagline">Investigate your BCF files with precision</p>
          </div>
          <button id="help-button" class="help-button" title="Open Help Guide">
            <span class="help-icon">üí°</span>
            Help
          </button>
        </div>
      </div>
    </header>

    <main class="container">
      <!-- File Upload Section -->
      <section id="upload-section" class="card">
        <div id="drop-zone" class="drop-zone">
          <div class="drop-zone-content">
            <div class="upload-icon">üìÅ</div>
            <h3>Drop BCF files here</h3>
            <p>or click to browse</p>
            <input type="file" id="file-input" accept=".bcf,.bcfzip" multiple />
          </div>
        </div>

        <div id="file-list" class="file-list hidden">
          <h4>Selected Files:</h4>
          <ul id="selected-files"></ul>
          <button id="process-btn" class="btn btn-primary">
            Process Files
          </button>
        </div>
      </section>

      <!-- BCFSleuth Logo - Only visible on landing page -->
      <div id="landing-logo" class="landing-logo">
        <img src="BCFSleuth_Logo_Color.png" alt="BCFSleuth Logo" />
      </div>

      <!-- Processing Status -->
      <section id="status-section" class="card hidden">
        <div id="processing-status">
          <div class="spinner hidden"></div>
          <p id="status-text">Ready to process files...</p>
        </div>
      </section>

      <!-- Results Section -->
      <section id="results-section" class="card hidden">
        <h3>BCF Analysis Results</h3>

        <div id="project-info" class="info-grid">
          <div class="info-item">
            <label>Project Name:</label>
            <span id="project-name">-</span>
          </div>
          <div class="info-item">
            <label>BCF Version:</label>
            <span id="bcf-version">-</span>
          </div>
          <div class="info-item">
            <label>Total Topics:</label>
            <span id="topic-count">-</span>
          </div>
          <div class="info-item">
            <label>Files Processed:</label>
            <span id="files-processed">-</span>
          </div>
        </div>

        <!-- Enhanced Data Preview with Tabs -->
        <div id="data-preview" class="data-preview">
          <!-- Tab Navigation -->
          <div class="preview-tabs">
            <button class="tab-button active" data-tab="simple">
              Simple Preview
            </button>
            <button class="tab-button" data-tab="advanced">
              Advanced Preview
            </button>
            <button class="tab-button" data-tab="image-viewer">
              Image Viewer
            </button>
            <button class="tab-button" data-tab="analytics">Analytics</button>
            <button class="tab-button" data-tab="configuration">
              Configuration
            </button>
          </div>

          <!-- Simple Preview Tab (Your existing preview enhanced) -->
          <div class="tab-content active" id="simple-tab">
            <div class="simple-preview">
              <h4>Quick Preview (First 5 Topics)</h4>
              <div class="table-container">
                <table id="preview-table">
                  <thead>
                    <tr>
                      <th>Title</th>
                      <th>Status</th>
                      <th>Priority</th>
                      <th>Author</th>
                      <th>Created</th>
                    </tr>
                  </thead>
                  <tbody id="preview-tbody"></tbody>
                </table>
              </div>
              <div class="preview-summary" id="simple-summary">
                <!-- Summary will be populated by JavaScript -->
              </div>
            </div>
          </div>

          <!-- Advanced Preview Tab -->
          <div class="tab-content" id="advanced-tab">
            <!-- Preview Field Connection Notice -->
            <div class="preview-notice">
              <div class="notice-content">
                <div class="notice-icon">‚ÑπÔ∏è</div>
                <div class="notice-text">
                  <strong
                    >Table columns match your export field selection.</strong
                  >
                  Change field selection in
                  <a href="#" onclick="scrollToExportOptions()"
                    >Export Options</a
                  >
                  below to show different columns.
                </div>
              </div>
            </div>

            <!-- Data Summary Stats -->
            <div class="data-summary">
              <div class="summary-item">
                <span class="summary-value" id="summary-total-topics">0</span>
                <span class="summary-label">Total Topics</span>
              </div>
              <div class="summary-item">
                <span class="summary-value" id="summary-total-comments">0</span>
                <span class="summary-label">Total Comments</span>
              </div>
              <div class="summary-item">
                <span class="summary-value" id="summary-open-issues">0</span>
                <span class="summary-label">Open Issues</span>
              </div>
              <div class="summary-item">
                <span class="summary-value" id="summary-high-priority">0</span>
                <span class="summary-label">High Priority</span>
              </div>
              <div class="summary-item">
                <span class="summary-value" id="summary-overdue">0</span>
                <span class="summary-label">Overdue</span>
              </div>
            </div>

            <!-- Advanced Controls -->
            <div class="advanced-controls">
              <div class="control-group">
                <label for="search-input">Search:</label>
                <input
                  type="text"
                  id="search-input"
                  class="control-input search-input"
                  placeholder="Search across all fields..."
                />
              </div>

              <div class="control-group">
                <label for="status-filter">Status:</label>
                <select id="status-filter" class="control-input">
                  <option value="">All Statuses</option>
                  <!-- Options will be populated dynamically -->
                </select>
              </div>

              <div class="control-group">
                <label for="priority-filter">Priority:</label>
                <select id="priority-filter" class="control-input">
                  <option value="">All Priorities</option>
                  <!-- Options will be populated dynamically -->
                </select>
              </div>

              <div class="control-group">
                <label for="assignee-filter">Assigned To:</label>
                <select id="assignee-filter" class="control-input">
                  <option value="">All Assignees</option>
                  <!-- Options will be populated dynamically -->
                </select>
              </div>

              <div class="control-group">
                <label for="due-date-filter">Due Date:</label>
                <select id="due-date-filter" class="control-input">
                  <option value="">All Dates</option>
                  <option value="overdue">Overdue</option>
                  <option value="this-week">This Week</option>
                  <option value="next-week">Next Week</option>
                  <option value="no-due-date">No Due Date</option>
                </select>
              </div>

              <div class="control-group">
                <label for="page-size">Show:</label>
                <select id="page-size" class="control-input">
                  <option value="25" selected>25 rows</option>
                  <option value="50">50 rows</option>
                  <option value="100">100 rows</option>
                </select>
              </div>
              <div class="control-group">
                <label>Comments:</label>
                <button
                  id="expand-all-btn"
                  class="control-btn"
                  onclick="window.bcfApp.advancedPreview.expandAllTopics()"
                >
                  Expand All
                </button>
                <button
                  id="collapse-all-btn"
                  class="control-btn"
                  onclick="window.bcfApp.advancedPreview.collapseAllTopics()"
                >
                  Collapse All
                </button>
                <span class="control-hint">
                  <span class="blue-triangle">‚ñ∂</span> Click blue arrows to
                  expand topics and reveal comment fields (Comment #, Date,
                  Author, Text) and additional viewpoint coordinates
                </span>
              </div>
            </div>

            <!-- Active Filters -->
            <div
              class="filter-controls"
              id="active-filters"
              style="display: none"
            >
              <!-- Active filter tags will be inserted here -->
            </div>

            <!-- Advanced Table -->
            <div class="advanced-table-container">
              <div class="table-wrapper">
                <table class="advanced-table" id="advanced-table">
                  <thead>
                    <tr id="advanced-table-headers">
                      <!-- Headers will be populated dynamically based on selected fields -->
                    </tr>
                  </thead>
                  <tbody id="advanced-table-body">
                    <!-- Table rows will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>

              <!-- Pagination -->
              <div class="pagination-container">
                <div class="pagination-info">
                  Showing <span id="showing-start">0</span> to
                  <span id="showing-end">0</span> of
                  <span id="total-filtered">0</span> items
                </div>
                <div class="pagination-controls">
                  <button
                    class="pagination-button"
                    id="first-page"
                    title="First page"
                  >
                    ‚ü®‚ü®
                  </button>
                  <button
                    class="pagination-button"
                    id="prev-page"
                    title="Previous page"
                  >
                    ‚ü®
                  </button>
                  <span id="page-numbers">
                    <!-- Page numbers will be inserted here -->
                  </span>
                  <button
                    class="pagination-button"
                    id="next-page"
                    title="Next page"
                  >
                    ‚ü©
                  </button>
                  <button
                    class="pagination-button"
                    id="last-page"
                    title="Last page"
                  >
                    ‚ü©‚ü©
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Image Viewer Tab -->
        <div class="tab-content" id="image-viewer-tab">
          <div class="image-viewer-content">
            <!-- Image Viewer Header -->
            <div class="image-viewer-header">
              <div class="viewer-title">
                <h4>BCF Image Gallery</h4>
                <p class="viewer-description">
                  View images and viewpoints from your BCF files
                </p>
              </div>
              <div class="viewer-stats" id="image-viewer-stats">
                <div class="stat-item">
                  <span class="stat-value" id="total-images">0</span>
                  <span class="stat-label">Images</span>
                </div>
                <div class="stat-item">
                  <span class="stat-value" id="total-topics-with-images"
                    >0</span
                  >
                  <span class="stat-label">Topics with Images</span>
                </div>
                <div class="stat-item">
                  <span class="stat-value" id="unique-projects-images">0</span>
                  <span class="stat-label">Projects</span>
                </div>
              </div>
            </div>

            <!-- Image Viewer Controls -->
            <div class="image-viewer-controls">
              <div class="control-group">
                <label for="image-project-filter">Project:</label>
                <select id="image-project-filter" class="control-input">
                  <option value="">All Projects</option>
                  <!-- Options will be populated dynamically -->
                </select>
              </div>

              <div class="control-group">
                <label for="image-title-filter">Title:</label>
                <select id="image-title-filter" class="control-input">
                  <option value="">All Titles</option>
                  <!-- Options will be populated dynamically -->
                </select>
              </div>

              <div class="control-group">
                <label for="image-status-filter">Status:</label>
                <select id="image-status-filter" class="control-input">
                  <option value="">All Statuses</option>
                  <!-- Options will be populated dynamically -->
                </select>
              </div>

              <div class="control-group">
                <label for="image-priority-filter">Priority:</label>
                <select id="image-priority-filter" class="control-input">
                  <option value="">All Priorities</option>
                  <!-- Options will be populated dynamically -->
                </select>
              </div>

              <div class="control-group">
                <label for="image-author-filter">Author:</label>
                <select id="image-author-filter" class="control-input">
                  <option value="">All Authors</option>
                  <!-- Options will be populated dynamically -->
                </select>
              </div>

              <div class="control-group">
                <label for="image-created-filter">Created:</label>
                <select id="image-created-filter" class="control-input">
                  <option value="">All Dates</option>
                  <option value="today">Today</option>
                  <option value="this-week">This Week</option>
                  <option value="this-month">This Month</option>
                  <option value="last-30-days">Last 30 Days</option>
                  <!-- More options will be populated dynamically -->
                </select>
              </div>

              <div class="control-group">
                <label for="image-search">Search:</label>
                <input
                  type="text"
                  id="image-search"
                  class="control-input search-input"
                  placeholder="Search topic titles..."
                />
              </div>

              <div class="control-group">
                <label for="image-sort">Sort by:</label>
                <select id="image-sort" class="control-input">
                  <option value="title">Topic Title</option>
                  <option value="date" selected>Creation Date</option>
                  <option value="status">Status</option>
                  <option value="priority">Priority</option>
                  <option value="author">Author</option>
                </select>
              </div>
            </div>

            <!-- Bulk Download Actions -->
            <div
              class="image-bulk-actions"
              id="image-bulk-actions"
              style="display: none"
            >
              <div class="bulk-actions-header">
                <h5>Bulk Download</h5>
                <span class="bulk-count" id="bulk-download-count"
                  >0 images selected</span
                >
              </div>
              <div class="bulk-actions-buttons">
                <button
                  class="btn btn-primary"
                  onclick="window.bcfApp.imageViewer.downloadAllImages()"
                >
                  üíæ Download All
                </button>
                <button
                  class="btn btn-secondary"
                  onclick="window.bcfApp.imageViewer.downloadImagesAsZip()"
                >
                  üì¶ Download as ZIP
                </button>
                <button
                  class="btn btn-secondary"
                  onclick="window.bcfApp.imageViewer.generatePDFReport()"
                >
                  üìÑ Generate PDF Report
                </button>
                <button
                  class="btn btn-secondary"
                  onclick="window.bcfApp.imageViewer.generateWordReport()"
                >
                  üìù Generate Word Report
                </button>
              </div>
            </div>

            <!-- No Images Message (shown when no BCF files loaded) -->
            <div class="no-images-message" id="no-images-message">
              <div class="no-images-content">
                <div class="no-images-icon">üñºÔ∏è</div>
                <h3>No Images Available</h3>
                <p>
                  Process some BCF files first to view their images and
                  viewpoints here.
                </p>
                <p>
                  <em
                    >Images will appear as cards with topic information and
                    image thumbnails.</em
                  >
                </p>
              </div>
            </div>

            <!-- Image Cards Grid -->
            <div class="image-cards-container" id="image-cards-container">
              <!-- Cards will be populated by JavaScript -->
            </div>

            <!-- Image Viewer Pagination -->
            <div
              class="image-pagination-container"
              id="image-pagination"
              style="display: none"
            >
              <div class="pagination-info">
                Showing <span id="images-showing-start">0</span> to
                <span id="images-showing-end">0</span> of
                <span id="images-total-filtered">0</span> images
              </div>
              <div class="pagination-controls">
                <button
                  class="pagination-button"
                  id="images-first-page"
                  title="First page"
                >
                  ‚ü®‚ü®
                </button>
                <button
                  class="pagination-button"
                  id="images-prev-page"
                  title="Previous page"
                >
                  ‚ü®
                </button>
                <span id="images-page-numbers">
                  <!-- Page numbers will be inserted here -->
                </span>
                <button
                  class="pagination-button"
                  id="images-next-page"
                  title="Next page"
                >
                  ‚ü©
                </button>
                <button
                  class="pagination-button"
                  id="images-last-page"
                  title="Last page"
                >
                  ‚ü©‚ü©
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Analytics Tab -->
        <div class="tab-content" id="analytics-tab">
          <div class="analytics-content">
            <!-- Analytics Header -->
            <div class="analytics-header">
              <div class="analytics-title">
                <h4>BCF Analytics Dashboard</h4>
                <p class="analytics-description">
                  Visual insights and trends from your BCF data
                </p>
              </div>
              <div class="analytics-stats" id="analytics-stats">
                <div class="stat-item">
                  <span class="stat-value" id="analytics-total-topics">0</span>
                  <span class="stat-label">Total Topics</span>
                </div>
                <div class="stat-item">
                  <span class="stat-value" id="analytics-total-comments"
                    >0</span
                  >
                  <span class="stat-label">Total Comments</span>
                </div>
                <div class="stat-item">
                  <span class="stat-value" id="analytics-total-projects"
                    >0</span
                  >
                  <span class="stat-label">Projects</span>
                </div>
                <div class="stat-item">
                  <span class="stat-value" id="analytics-avg-comments">0</span>
                  <span class="stat-label">Avg Comments/Topic</span>
                </div>
              </div>
            </div>

            <!-- Analytics Controls -->
            <div class="analytics-controls">
              <div class="control-group">
                <label for="analytics-date-range">Date Range:</label>
                <select id="analytics-date-range" class="control-input">
                  <option value="all">All Time</option>
                  <option value="last-30-days">Last 30 Days</option>
                  <option value="last-90-days">Last 90 Days</option>
                  <option value="this-year">This Year</option>
                </select>
              </div>

              <div class="control-group">
                <button id="export-charts-btn" class="btn btn-secondary">
                  üìä Export Charts (PNG)
                </button>
                <button id="export-charts-pdf-btn" class="btn btn-secondary">
                  üìÑ Export Charts (PDF)
                </button>
                <button id="custom-report-btn" class="btn btn-secondary">
                  üìã Custom Report
                </button>
              </div>
            </div>

            <!-- No Data Message -->
            <div class="no-analytics-message" id="no-analytics-message">
              <div class="no-analytics-content">
                <div class="no-analytics-icon">üìä</div>
                <h3>No Data Available</h3>
                <p>
                  Process some BCF files first to see analytics and insights
                  here.
                </p>
                <p>
                  <em
                    >Charts and statistics will appear automatically when data
                    is loaded.</em
                  >
                </p>
              </div>
            </div>

            <!-- Charts Grid -->
            <div
              class="analytics-charts-grid"
              id="analytics-charts-grid"
              style="display: none"
            >
              <!-- Status Distribution Chart -->
              <div class="chart-container">
                <div class="chart-header">
                  <h5>Status Distribution</h5>
                  <p>Breakdown of topic statuses</p>
                </div>
                <div class="chart-wrapper">
                  <canvas id="status-chart" width="400" height="300"></canvas>
                </div>
              </div>

              <!-- Priority Distribution Chart -->
              <div class="chart-container">
                <div class="chart-header">
                  <h5>Priority Distribution</h5>
                  <p>Priority levels of topics</p>
                </div>
                <div class="chart-wrapper">
                  <canvas id="priority-chart" width="400" height="300"></canvas>
                </div>
              </div>

              <!-- Creation Timeline Chart -->
              <div class="chart-container chart-container-wide">
                <div class="chart-header">
                  <h5>Topic Creation Timeline</h5>
                  <p>Topics created over time</p>
                </div>
                <div class="chart-wrapper">
                  <canvas id="timeline-chart" width="800" height="300"></canvas>
                </div>
              </div>

              <!-- Author Activity Chart -->
              <div class="chart-container">
                <div class="chart-header">
                  <h5>Author Activity</h5>
                  <p>Topics created by author</p>
                </div>
                <div class="chart-wrapper">
                  <canvas id="author-chart" width="400" height="300"></canvas>
                </div>
              </div>

              <!-- Comments Analysis Chart -->
              <div class="chart-container">
                <div class="chart-header">
                  <h5>Comments Analysis</h5>
                  <p>Comment activity patterns</p>
                </div>
                <div class="chart-wrapper">
                  <canvas id="comments-chart" width="400" height="300"></canvas>
                </div>
              </div>

              <!-- Custom Report Builder -->
              <div
                class="chart-container chart-container-wide"
                id="custom-report-container"
                style="display: none"
              >
                <div class="chart-header">
                  <h5>Custom Report Builder</h5>
                  <p>Create custom analytics based on selected fields</p>
                </div>
                <div class="custom-report-builder">
                  <div class="report-field-selection">
                    <h6>Select Fields for Analysis:</h6>
                    <div class="report-field-grid" id="report-field-grid">
                      <!-- Dynamic field checkboxes will be populated here -->
                    </div>
                  </div>
                  <div class="report-actions">
                    <button id="generate-report-btn" class="btn btn-primary">
                      Generate Analysis
                    </button>
                    <div class="export-format-group">
                      <label for="report-export-format">Export as:</label>
                      <select
                        id="report-export-format"
                        class="control-input"
                        disabled
                      >
                        <option value="text">üìÑ Text File</option>
                        <option value="pdf">üìÑ PDF Document</option>
                        <option value="word">üìù Word Document</option>
                      </select>
                      <button
                        id="export-custom-report-btn"
                        class="btn btn-secondary"
                        disabled
                      >
                        Export Report
                      </button>
                    </div>
                    <button
                      id="close-report-builder-btn"
                      class="btn btn-secondary"
                    >
                      Close Builder
                    </button>
                  </div>
                  <div class="custom-report-results" id="custom-report-results">
                    <!-- Custom analysis results will appear here -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ADD THIS NEW CONFIGURATION TAB -->
        <div class="tab-content" id="configuration-tab">
          <div class="configuration-content">
            <!-- Export Templates Section -->
            <div class="config-section">
              <h4>Export Templates</h4>
              <p class="section-description">
                Save and manage field selection combinations for quick reuse
              </p>

              <div class="template-management">
                <!-- Template Import/Export Actions (moved to top) -->
                <div class="template-import-export">
                  <h5>Template Management</h5>
                  <div class="template-file-actions">
                    <button
                      id="export-templates-btn"
                      class="btn btn-secondary"
                      title="Download all templates as JSON file"
                    >
                      üìÅ Export Templates
                    </button>
                    <button
                      id="import-templates-btn"
                      class="btn btn-secondary"
                      title="Import templates from JSON file"
                    >
                      üì• Import Templates
                    </button>
                    <input
                      type="file"
                      id="import-file-input"
                      accept=".json"
                      style="display: none"
                    />
                  </div>
                  <div class="template-file-info">
                    <small
                      >Export templates to backup or share with your team.
                      Import templates from other devices or team
                      members.</small
                    >
                  </div>
                </div>

                <!-- Main Template Management Grid (NEW) -->
                <div class="template-main-grid">
                  <!-- Saved Templates (Left Side) -->
                  <div class="saved-templates">
                    <h5>Saved Templates</h5>
                    <div id="templates-list" class="templates-list">
                      <div class="empty-state">
                        <p>
                          No templates saved yet. Create your first template
                          below.
                        </p>
                      </div>
                    </div>
                  </div>

                  <!-- Template Creation (Right Side) -->
                  <div class="template-creation">
                    <h5>Create New Template</h5>
                    <div class="template-form">
                      <div class="form-group">
                        <label for="template-name">Template Name:</label>
                        <input
                          type="text"
                          id="template-name"
                          placeholder="e.g., Essential BCF Export"
                        />
                      </div>
                      <div class="form-group">
                        <label for="template-description"
                          >Description (optional):</label
                        >
                        <input
                          type="text"
                          id="template-description"
                          placeholder="e.g., Essential fields for BCF analysis and reporting"
                        />
                      </div>
                      <div class="form-group">
                        <label for="template-filename"
                          >Custom Filename Template:</label
                        >
                        <input
                          type="text"
                          id="template-filename"
                          value="{project_name}_BCF_Export_{date}"
                          placeholder="e.g., {project_name}_BCF_Export_{date}"
                        />
                        <small
                          >Available variables: {project_name}, {date}, {time},
                          {template_name}</small
                        >
                      </div>
                      <div class="form-actions">
                        <button id="save-template-btn" class="btn btn-primary">
                          Save Template
                        </button>
                        <button
                          id="save-from-current-btn"
                          class="btn btn-secondary"
                        >
                          Save From Current Selection
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Session Preferences Section -->
            <div class="config-section">
              <h4>User Preferences</h4>
              <p class="section-description">
                Customize your BCFSleuth experience
              </p>

              <div class="preferences-grid">
                <div class="pref-group">
                  <label for="default-export-format"
                    >Default Export Format:</label
                  >
                  <select id="default-export-format">
                    <option value="excel">Excel (.xlsx)</option>
                    <option value="csv">CSV</option>
                  </select>
                </div>

                <div class="pref-group">
                  <label for="default-page-size"
                    >Default Table Page Size:</label
                  >
                  <select id="default-page-size">
                    <option value="25">25 rows</option>
                    <option value="50" selected>50 rows</option>
                    <option value="100">100 rows</option>
                  </select>
                </div>

                <div class="pref-group">
                  <label>
                    <input
                      type="checkbox"
                      id="remember-field-selections"
                      checked
                    />
                    Remember field selections between sessions
                  </label>
                </div>

                <div class="pref-group">
                  <label>
                    <input type="checkbox" id="show-tooltips" checked />
                    Show tooltips in advanced preview
                  </label>
                </div>

                <div class="pref-group">
                  <label>
                    <input type="checkbox" id="auto-save-session" checked />
                    Auto-save session data
                  </label>
                </div>
              </div>

              <div class="form-actions">
                <button id="save-preferences-btn" class="btn btn-primary">
                  Save Preferences
                </button>
                <button id="reset-preferences-btn" class="btn btn-secondary">
                  Reset to Defaults
                </button>
              </div>
            </div>

            <!-- Processing History Section -->
            <div class="config-section">
              <h4>Processing History</h4>
              <p class="section-description">
                View and manage your recent BCF analysis sessions
              </p>

              <div class="history-container">
                <div id="processing-history" class="history-list">
                  <div class="empty-state">
                    <p>
                      No processing history yet. Process some BCF files to see
                      history.
                    </p>
                  </div>
                </div>

                <div class="history-actions">
                  <button id="clear-history-btn" class="btn btn-secondary">
                    Clear History
                  </button>
                  <button id="export-history-btn" class="btn btn-secondary">
                    Export History
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Export Controls -->
        <div class="export-controls" id="main-export-controls">
          <h4>Export Options</h4>

          <!-- Field Selection -->
          <div class="field-selection">
            <h5>
              Select Fields to Export
              <span class="field-count" id="field-count"
                >0 of 25 fields selected</span
              >
            </h5>

            <div class="field-selection-controls">
              <button id="select-all-fields" class="btn btn-secondary">
                Select All
              </button>
              <button id="clear-all-fields" class="btn btn-secondary">
                Clear All
              </button>
              <button id="select-essential" class="btn btn-secondary">
                Essential Only
              </button>
            </div>

            <div class="field-categories">
              <!-- Topic Information -->
              <div class="field-category">
                <h6 class="category-header">
                  <button
                    class="category-expand-button"
                    onclick="testClick()"
                    title="Test Button Click"
                  >
                    <span class="expand-icon">‚ñ∂</span>
                  </button>
                  Topic Information
                </h6>
                <div
                  class="field-grid category-content"
                  data-category="topic-info"
                >
                  <div class="field-item">
                    <input type="checkbox" id="field-title" checked />
                    <label for="field-title">Title</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-description" checked />
                    <label for="field-description">Description</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-status" checked />
                    <label for="field-status">Status</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-type" checked />
                    <label for="field-type">Type</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-priority" checked />
                    <label for="field-priority">Priority</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-stage" />
                    <label for="field-stage">Stage</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-labels" />
                    <label for="field-labels">Labels</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-assigned-to" />
                    <label for="field-assigned-to">Assigned To</label>
                  </div>
                </div>
              </div>

              <!-- Dates & Authors -->
              <div class="field-category">
                <h6 class="category-header">
                  <button
                    class="category-expand-button"
                    onclick="toggleExportCategory('dates-authors')"
                    title="Expand/Collapse Dates & Authors"
                  >
                    <span class="expand-icon">‚ñ∂</span>
                  </button>
                  Dates & Authors
                </h6>
                <div
                  class="field-grid category-content"
                  data-category="dates-authors"
                >
                  <div class="field-item">
                    <input type="checkbox" id="field-creation-date" checked />
                    <label for="field-creation-date">Creation Date</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-creation-author" checked />
                    <label for="field-creation-author">Creation Author</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-modified-date" />
                    <label for="field-modified-date">Modified Date</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-modified-author" />
                    <label for="field-modified-author">Modified Author</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-due-date" />
                    <label for="field-due-date">Due Date</label>
                  </div>
                </div>
              </div>

              <!-- File & Project Info -->
              <div class="field-category">
                <h6 class="category-header">
                  <button
                    class="category-expand-button"
                    onclick="toggleExportCategory('file-project')"
                    title="Expand/Collapse File & Project Info"
                  >
                    <span class="expand-icon">‚ñ∂</span>
                  </button>
                  File & Project Info
                </h6>
                <div
                  class="field-grid category-content"
                  data-category="file-project"
                >
                  <div class="field-item">
                    <input type="checkbox" id="field-source-file" checked />
                    <label for="field-source-file">Source File</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-project-name" checked />
                    <label for="field-project-name">Project Name</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-bcf-version" />
                    <label for="field-bcf-version">BCF Version</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-topic-guid" />
                    <label for="field-topic-guid">Topic GUID</label>
                  </div>
                </div>
              </div>

              <!-- Comments & Counts -->
              <div class="field-category">
                <h6 class="category-header">
                  <button
                    class="category-expand-button"
                    onclick="toggleExportCategory('comments-counts')"
                    title="Expand/Collapse Comments & Counts"
                  >
                    <span class="expand-icon">‚ñ∂</span>
                  </button>
                  Comments & Counts
                </h6>
                <div
                  class="field-grid category-content"
                  data-category="comments-counts"
                >
                  <div class="field-item">
                    <input type="checkbox" id="field-comments-count" checked />
                    <label for="field-comments-count">Comments Count</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-viewpoints-count" />
                    <label for="field-viewpoints-count">Viewpoints Count</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-comment-number" checked />
                    <label for="field-comment-number">Comment Number</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-comment-date" checked />
                    <label for="field-comment-date">Comment Date</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-comment-author" checked />
                    <label for="field-comment-author">Comment Author</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-comment-text" checked />
                    <label for="field-comment-text">Comment Text</label>
                  </div>
                  <div class="field-item">
                    <input type="checkbox" id="field-comment-status" />
                    <label for="field-comment-status">Comment Status</label>
                  </div>
                </div>
                <!-- Export Buttons (outside the blue field selection area) -->
                <div class="export-buttons">
                  <button id="export-csv" class="btn btn-secondary">
                    Download CSV
                  </button>
                  <button id="export-excel" class="btn btn-primary" disabled>
                    Download Excel
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Help Center Modal -->
    <div id="help-modal" class="help-modal hidden">
      <div class="help-modal-overlay"></div>
      <div class="help-modal-content">
        <!-- Help Modal Header -->
        <div class="help-modal-header">
          <h3>BCFSleuth Help Guide</h3>
          <div class="help-header-actions">
            <a
              href="https://thebimsider.github.io/bcfsleuth/Docs/"
              target="_blank"
              rel="noopener noreferrer"
              class="help-docs-link"
              title="View Full Documentation"
            >
              üìñ Full Docs
            </a>
            <button class="help-modal-close" id="help-modal-close">‚úï</button>
          </div>
        </div>
        <!-- Help Modal Body -->
        <div class="help-modal-body">
          <!-- Help Content Sections -->
          <div class="help-sections">
            <!-- Quick Start Section -->
            <div class="help-section active" data-section="quick-start">
              <h4>üöÄ Quick Start</h4>
              <div class="help-content">
                <p>Get started with BCFSleuth in 4 simple steps:</p>
                <ol>
                  <li>
                    <strong>Upload Files:</strong> Drag and drop your BCF files
                    onto the upload area, or click to browse and select files
                  </li>
                  <li>
                    <strong>Process:</strong> Click the "Process Files" button
                    to analyze your BCF data
                  </li>
                  <li>
                    <strong>Explore:</strong> Use the different tabs to view
                    your data in various ways
                  </li>
                  <li>
                    <strong>Export:</strong> Choose your desired fields and
                    download reports in multiple formats
                  </li>
                </ol>
                <div class="help-tip">
                  <strong>üí° Pro Tip:</strong> Start with the Simple Preview tab
                  for a quick overview, then move to Advanced Preview for
                  detailed analysis.
                </div>
              </div>
            </div>

            <!-- Understanding Tabs Section -->
            <div class="help-section" data-section="tabs">
              <h4>üìã Understanding the Interface</h4>
              <div class="help-content">
                <div class="tab-explanation">
                  <h5>üìã Simple Preview</h5>
                  <p>
                    Shows the first 5 topics in a basic table format. Perfect
                    for getting a quick overview of your BCF file contents
                    without any complexity.
                  </p>
                </div>
                <div class="tab-explanation">
                  <h5>üîç Advanced Preview</h5>
                  <p>
                    A powerful data table with sorting, filtering, and search
                    capabilities. Use this to dive deep into your data, filter
                    by status or priority, and expand topics to see comments and
                    additional viewpoint coordinates.
                  </p>
                </div>
                <div class="tab-explanation">
                  <h5>üñºÔ∏è Image Viewer</h5>
                  <p>
                    Browse all images and viewpoints from your BCF files in a
                    visual gallery. Filter images, view them full-screen, and
                    download individual images or create reports.
                  </p>
                </div>
                <div class="tab-explanation">
                  <h5>üìä Analytics</h5>
                  <p>
                    Visual charts and statistics about your BCF data. See status
                    distributions, priority breakdowns, timeline trends, and
                    create custom analytics reports.
                  </p>
                </div>
                <div class="tab-explanation">
                  <h5>‚öôÔ∏è Configuration</h5>
                  <p>
                    Manage export templates, set user preferences, and view your
                    processing history. Enable viewpoint coordinate fields (18
                    available) and save field selections as templates for
                    consistent exports.
                  </p>
                </div>
              </div>
            </div>

            <!-- BCF File Basics Section -->
            <div class="help-section" data-section="bcf-basics">
              <h4>üìÑ About BCF Files</h4>
              <div class="help-content">
                <p>
                  <strong>BCF (Building Collaboration Format)</strong> is an
                  open standard for exchanging issues and comments related to
                  BIM models.
                </p>

                <h5>What BCFSleuth extracts from your files:</h5>
                <ul>
                  <li>
                    <strong>Topics:</strong> Individual issues, questions, or
                    discussion points
                  </li>
                  <li>
                    <strong>Comments:</strong> Conversations and responses
                    related to each topic
                  </li>
                  <li>
                    <strong>Images/Viewpoints:</strong> Screenshots showing the
                    location and context of issues
                  </li>
                  <li>
                    <strong>Viewpoint Coordinates:</strong> Camera positions,
                    directions, and properties (18 coordinate fields available
                    in Configuration)
                  </li>
                  <li>
                    <strong>Metadata:</strong> Status, priority, assignments,
                    due dates, and other project information
                  </li>
                  <li>
                    <strong>Project Info:</strong> BCF version, creation dates,
                    author information
                  </li>
                </ul>

                <div class="help-tip">
                  <strong>üîí Your Privacy is Protected:</strong> All file
                  processing happens entirely in your browser. No data is ever
                  uploaded to any server or cloud service.
                </div>
              </div>
            </div>

            <!-- Key Features Section -->
            <div class="help-section" data-section="features">
              <h4>‚≠ê Key Features</h4>
              <div class="help-content">
                <div class="feature-group">
                  <h5>Universal Format Support</h5>
                  <p>
                    Works with all BCF versions (2.0, 2.1, 3.0) from any BIM
                    software including Revit, ArchiCAD, Tekla, Solibri, and
                    more.
                  </p>
                </div>

                <div class="feature-group">
                  <h5>Advanced Filtering & Search</h5>
                  <p>
                    Filter data by status, priority, assignee, and due dates.
                    Search across all fields instantly with real-time results.
                  </p>
                </div>

                <div class="feature-group">
                  <h5>Comment Management</h5>
                  <p>
                    Click the blue ‚ñ∂ arrows in tables to expand topics and view
                    all associated comments inline.
                  </p>
                </div>

                <div class="feature-group">
                  <h5>Flexible Export Options</h5>
                  <p>
                    Export data as CSV, Excel, PDF, or Word documents. Choose
                    exactly which fields to include in your exports, including
                    18 viewpoint coordinate fields.
                  </p>
                </div>

                <div class="feature-group">
                  <h5>Professional Image Reports</h5>
                  <p>
                    Create comprehensive image reports with multiple layout
                    options, or download images individually or in bulk ZIP
                    files.
                  </p>
                </div>

                <div class="feature-group">
                  <h5>Visual Analytics</h5>
                  <p>
                    Interactive charts showing data patterns, trends, and
                    distributions. Click any chart for full-screen viewing with
                    zoom capabilities.
                  </p>
                </div>
              </div>
            </div>

            <!-- Troubleshooting Section -->
            <div class="help-section" data-section="troubleshooting">
              <h4>üîß Common Questions & Solutions</h4>
              <div class="help-content">
                <div class="faq-item">
                  <h5>‚ùì My BCF file won't upload</h5>
                  <p>
                    Ensure your file has a .bcf or .bcfzip extension. Files must
                    be valid BCF format. Try refreshing the page and uploading
                    again.
                  </p>
                </div>

                <div class="faq-item">
                  <h5>‚ùì I don't see any images in the Image Viewer</h5>
                  <p>
                    Not all BCF files contain images. Ensure your BCF file was
                    exported with viewpoints/screenshots included from your BIM
                    software.
                  </p>
                </div>

                <div class="faq-item">
                  <h5>‚ùì Some data fields are missing</h5>
                  <p>
                    BCF files vary in content depending on how they were
                    created. Only fields present in your files will be available
                    for selection and export.
                  </p>
                </div>

                <div class="faq-item">
                  <h5>‚ùì Export button is disabled</h5>
                  <p>
                    You must select at least one field in the Export Options
                    section before you can download files.
                  </p>
                </div>

                <div class="faq-item">
                  <h5>‚ùì Charts aren't loading in Analytics</h5>
                  <p>
                    Charts require processed BCF data. Make sure you've
                    successfully uploaded and processed BCF files first.
                  </p>
                </div>

                <div class="faq-item">
                  <h5>‚ùì How do I expand comments in the table?</h5>
                  <p>
                    Look for blue ‚ñ∂ arrows in the first column of the Advanced
                    Preview table. Click these to expand and see all comments
                    for that topic.
                  </p>
                </div>
                <div class="faq-item">
                  <h5>‚ùì I don't see viewpoint coordinate fields</h5>
                  <p>
                    Coordinate fields are unchecked by default. Go to
                    Configuration tab and look for "Viewpoint Coordinates (18
                    fields)" section to enable them. Not all BCF files contain
                    coordinate data.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Help Navigation Sidebar -->
          <div class="help-navigation">
            <button class="help-nav-btn active" data-section="quick-start">
              Quick Start
            </button>
            <button class="help-nav-btn" data-section="tabs">
              Interface Guide
            </button>
            <button class="help-nav-btn" data-section="bcf-basics">
              BCF Basics
            </button>
            <button class="help-nav-btn" data-section="features">
              Features
            </button>
            <button class="help-nav-btn" data-section="troubleshooting">
              FAQ
            </button>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <div class="container">
        <p>
          Built with ‚ù§Ô∏è & ü§ñ AI assistance by
          <a href="https://bio.link/thebimsider" target="_blank"
            >The BIMsider</a
          >
          for the AECO community.
          <br />
          Inspired by
          <a href="https://www.bim42.com/products/sloth.html" target="_blank"
            >Sloth</a
          >
          from <a href="https://www.bim42.com/" target="_blank">BIM42</a>
        </p>
      </div>
    </footer>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/3.0.1/jspdf.umd.min.js"></script>

    <!-- Try multiple DOCX sources with fallback -->
    <script>
      // Function to load DOCX library with fallback
      async function loadDocxLibrary() {
        const sources = [
          'https://unpkg.com/docx@7.8.2/build/index.js', // Older stable version
          'https://cdn.jsdelivr.net/npm/docx@7.8.2/build/index.js',
          'https://unpkg.com/docx@9.5.1/build/index.js',
          'https://cdn.jsdelivr.net/npm/docx@9.5.1/build/index.js',
        ];

        for (const src of sources) {
          try {
            console.log(`Trying to load DOCX from: ${src}`);

            const script = document.createElement('script');
            script.src = src;

            const loadPromise = new Promise((resolve, reject) => {
              script.onload = () => {
                setTimeout(() => {
                  if (typeof window.docx !== 'undefined') {
                    console.log(`‚úÖ DOCX loaded successfully from: ${src}`);
                    console.log(
                      'Available components:',
                      Object.keys(window.docx)
                    );
                    resolve(true);
                  } else {
                    reject(
                      new Error('Library loaded but window.docx not available')
                    );
                  }
                }, 1000); // Wait 1 second for library to initialize
              };

              script.onerror = () => {
                reject(new Error(`Failed to load from ${src}`));
              };

              // Timeout after 10 seconds
              setTimeout(() => {
                reject(new Error(`Timeout loading from ${src}`));
              }, 10000);
            });

            document.head.appendChild(script);
            await loadPromise;

            // If we get here, it worked
            return true;
          } catch (error) {
            console.warn(`Failed to load DOCX from ${src}:`, error.message);
            continue;
          }
        }

        console.error('‚ùå Failed to load DOCX from all sources');
        return false;
      }

      // Load the library when page is ready
      document.addEventListener('DOMContentLoaded', async () => {
        console.log('üîÑ Starting DOCX library loading...');
        const success = await loadDocxLibrary();

        if (success) {
          console.log('üéâ DOCX library is ready!');
          window.docxReady = true;
        } else {
          console.error('üí• DOCX library failed to load from all sources');
          window.docxReady = false;
        }
      });
    </script>
    <!-- Chart.js Library for Analytics (with fallback) -->
    <script>
      // Function to load Chart.js with fallback
      async function loadChartJS() {
        const sources = [
          'https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js',
          'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js',
          'https://unpkg.com/chart.js@3.9.1/dist/chart.min.js',
        ];

        for (const src of sources) {
          try {
            console.log(`Trying to load Chart.js from: ${src}`);

            const script = document.createElement('script');
            script.src = src;

            const loadPromise = new Promise((resolve, reject) => {
              script.onload = () => {
                setTimeout(() => {
                  if (typeof Chart !== 'undefined') {
                    console.log(`‚úÖ Chart.js loaded successfully from: ${src}`);
                    window.chartJSReady = true;
                    resolve(true);
                  } else {
                    reject(new Error('Chart object not available'));
                  }
                }, 500);
              };

              script.onerror = () => {
                reject(new Error(`Failed to load from ${src}`));
              };

              setTimeout(() => {
                reject(new Error(`Timeout loading from ${src}`));
              }, 10000);
            });

            document.head.appendChild(script);
            await loadPromise;

            return true;
          } catch (error) {
            console.warn(`Failed to load Chart.js from ${src}:`, error.message);
            continue;
          }
        }

        console.error('‚ùå Failed to load Chart.js from all sources');
        window.chartJSReady = false;
        return false;
      }

      // Load Chart.js when page is ready
      document.addEventListener('DOMContentLoaded', async () => {
        console.log('üîÑ Starting Chart.js library loading...');
        const success = await loadChartJS();

        if (success) {
          console.log('üéâ Chart.js library is ready!');
        } else {
          console.error('üí• Chart.js library failed to load from all sources');
        }
      });
    </script>

    <!-- Chart Lightbox Modal (similar to Image Lightbox) -->
    <div id="chart-lightbox" class="image-lightbox">
      <div
        class="lightbox-overlay"
        onclick="window.bcfApp.analyticsDashboard.closeChartLightbox()"
      ></div>
      <div class="lightbox-content">
        <!-- Chart Lightbox Header -->
        <div class="lightbox-header">
          <div class="lightbox-info">
            <h3 class="lightbox-title" id="chart-lightbox-title">
              Chart Title
            </h3>
            <div class="lightbox-meta" id="chart-lightbox-meta">
              <span class="lightbox-status" id="chart-lightbox-type"
                >Chart Type</span
              >
              <span class="lightbox-author" id="chart-lightbox-data-count"
                >Data Count</span
              >
              <span class="lightbox-date" id="chart-lightbox-filters"
                >Filters Applied</span
              >
            </div>
          </div>
          <button
            class="lightbox-close"
            onclick="window.bcfApp.analyticsDashboard.closeChartLightbox()"
            title="Close (Esc)"
          >
            ‚úï
          </button>
        </div>

        <!-- Chart Container -->
        <div class="lightbox-image-container">
          <!-- Large Chart Canvas -->
          <canvas id="lightbox-chart-canvas" class="lightbox-image"></canvas>

          <!-- Navigation Arrows for Chart Types -->
          <button
            class="lightbox-nav lightbox-prev"
            onclick="window.bcfApp.analyticsDashboard.navigateChartLightbox(-1)"
            title="Previous Chart (‚Üê)"
          >
            ‚Äπ
          </button>
          <button
            class="lightbox-nav lightbox-next"
            onclick="window.bcfApp.analyticsDashboard.navigateChartLightbox(1)"
            title="Next Chart (‚Üí)"
          >
            ‚Ä∫
          </button>

          <!-- Zoom Controls (reusing image viewer styles) -->
          <div class="lightbox-zoom-controls">
            <button
              onclick="window.bcfApp.analyticsDashboard.zoomChart('in')"
              title="Zoom In (+)"
            >
              üîç+
            </button>
            <button
              onclick="window.bcfApp.analyticsDashboard.zoomChart('out')"
              title="Zoom Out (-)"
            >
              üîç-
            </button>
            <button
              onclick="window.bcfApp.analyticsDashboard.resetChartZoom()"
              title="Reset Zoom (0)"
            >
              ‚åÇ
            </button>
            <button
              onclick="window.bcfApp.analyticsDashboard.fitChartToScreen()"
              title="Fit to Screen (F)"
            >
              ‚äû
            </button>
          </div>
        </div>

        <!-- Chart Actions -->
        <div class="lightbox-actions">
          <button
            class="lightbox-action-btn"
            onclick="window.bcfApp.analyticsDashboard.exportCurrentChart()"
            title="Export Current Chart"
          >
            üíæ Export PNG
          </button>
          <button
            class="lightbox-action-btn"
            onclick="window.bcfApp.analyticsDashboard.showChartDetails()"
            title="Show Chart Data Details"
          >
            ‚ÑπÔ∏è Chart Info
          </button>
          <div class="lightbox-counter" id="chart-lightbox-counter">
            1 of 5 charts
          </div>
        </div>
      </div>
    </div>

    <!-- Shared Utilities (MUST load first) -->
    <script src="js/utils/coordinate-utils.js"></script>
    <script src="js/utils/pdf-utils.js"></script>
    <script src="js/utils/color-manager.js"></script>

    <!-- Main application scripts (AFTER utilities) -->
    <script src="js/bcf-parser.js"></script>
    <script src="js/csv-exporter.js"></script>
    <script src="js/excel-exporter.js"></script>
    <script src="js/advanced-preview.js"></script>
    <script src="js/image-viewer.js"></script>
    <script src="js/analytics-dashboard.js"></script>
    <script src="js/configuration.js"></script>
    <script src="js/app.js"></script>

    <!-- Help System JavaScript -->
    <script>
      /**
       * Help System Controller
       * Manages the help modal, navigation, and user interactions
       * Simple, self-contained system that works independently
       */
      document.addEventListener('DOMContentLoaded', function () {
        // Get all the DOM elements we need
        const helpButton = document.getElementById('help-button');
        const helpModal = document.getElementById('help-modal');
        const helpModalClose = document.getElementById('help-modal-close');
        const helpModalOverlay = helpModal?.querySelector(
          '.help-modal-overlay'
        );
        const helpNavButtons = document.querySelectorAll('.help-nav-btn');
        const helpSections = document.querySelectorAll('.help-section');

        // Only proceed if help elements exist
        if (!helpButton || !helpModal) {
          console.log('Help system elements not found');
          return;
        }

        /**
         * Opens the help modal
         * Prevents body scrolling while modal is open
         */
        function openHelpModal() {
          helpModal.classList.remove('hidden');
          document.body.style.overflow = 'hidden';

          // Focus management for accessibility
          helpModalClose.focus();
        }

        /**
         * Closes the help modal
         * Restores body scrolling
         */
        function closeHelpModal() {
          helpModal.classList.add('hidden');
          document.body.style.overflow = '';

          // Return focus to help button
          helpButton.focus();
        }

        /**
         * Shows a specific help section
         * Updates navigation to reflect current section
         * @param {string} sectionName - The data-section value to show
         */
        function showHelpSection(sectionName) {
          // Hide all sections
          helpSections.forEach((section) => {
            section.classList.remove('active');
          });

          // Show the requested section
          const targetSection = document.querySelector(
            `[data-section="${sectionName}"]`
          );
          if (targetSection) {
            targetSection.classList.add('active');
          }

          // Update navigation buttons
          helpNavButtons.forEach((btn) => {
            btn.classList.remove('active');
            if (btn.dataset.section === sectionName) {
              btn.classList.add('active');
            }
          });

          // Scroll to top of help content
          const helpSectionsContainer =
            document.querySelector('.help-sections');
          if (helpSectionsContainer) {
            helpSectionsContainer.scrollTop = 0;
          }
        }

        // Event Listeners

        // Open help modal when help button is clicked
        helpButton.addEventListener('click', openHelpModal);

        // Close help modal when close button is clicked
        helpModalClose.addEventListener('click', closeHelpModal);

        // Close help modal when overlay is clicked
        helpModalOverlay.addEventListener('click', closeHelpModal);

        // Close help modal when Escape key is pressed
        document.addEventListener('keydown', function (event) {
          if (
            event.key === 'Escape' &&
            !helpModal.classList.contains('hidden')
          ) {
            closeHelpModal();
          }
        });

        // Handle navigation button clicks
        helpNavButtons.forEach((button) => {
          button.addEventListener('click', function () {
            const sectionName = this.dataset.section;
            showHelpSection(sectionName);
          });
        });

        // Initialize: Show the first section by default
        showHelpSection('quick-start');

        // Make functions available globally for debugging/extension
        window.helpSystem = {
          open: openHelpModal,
          close: closeHelpModal,
          showSection: showHelpSection,
        };

        console.log('‚úÖ Help system initialized successfully');
      });

      /**
       * Logo Visibility Controller
       * Shows the BCFSleuth logo ONLY on the initial landing page
       * Hides it as soon as any files are selected or processing begins
       */
      function initLogoController() {
        const landingLogo = document.getElementById('landing-logo');
        const fileList = document.getElementById('file-list');
        const statusSection = document.getElementById('status-section');
        const resultsSection = document.getElementById('results-section');

        if (!landingLogo || !fileList) return;

        /**
         * Hides the logo permanently once files are selected
         */
        function hideLogo() {
          landingLogo.style.display = 'none';
        }

        /**
         * Shows the logo only in pure landing state
         */
        function showLogo() {
          landingLogo.style.display = 'block';
        }

        /**
         * Checks if we're in pure landing state (no files selected)
         */
        function updateLogoVisibility() {
          const fileListVisible = !fileList.classList.contains('hidden');
          const statusVisible =
            statusSection && !statusSection.classList.contains('hidden');
          const resultsVisible =
            resultsSection && !resultsSection.classList.contains('hidden');

          // Show logo ONLY if no files are selected AND no processing AND no results
          if (!fileListVisible && !statusVisible && !resultsVisible) {
            showLogo();
          } else {
            hideLogo();
          }
        }

        // Watch for file selection changes (when file list appears/disappears)
        const fileListObserver = new MutationObserver(function (mutations) {
          mutations.forEach(function (mutation) {
            if (
              mutation.type === 'attributes' &&
              mutation.attributeName === 'class'
            ) {
              updateLogoVisibility();
            }
          });
        });

        // Start observing the file list for visibility changes
        fileListObserver.observe(fileList, {
          attributes: true,
          attributeFilter: ['class'],
        });

        // Also watch status and results if they exist
        if (statusSection) {
          const statusObserver = new MutationObserver(updateLogoVisibility);
          statusObserver.observe(statusSection, {
            attributes: true,
            attributeFilter: ['class'],
          });
        }

        if (resultsSection) {
          const resultsObserver = new MutationObserver(updateLogoVisibility);
          resultsObserver.observe(resultsSection, {
            attributes: true,
            attributeFilter: ['class'],
          });
        }

        // Initial check - set correct visibility based on current state
        updateLogoVisibility();

        console.log(
          '‚úÖ Logo controller initialized - logo only shows on pure landing page'
        );
      }
      // Initialize logo controller when DOM is ready
      document.addEventListener('DOMContentLoaded', initLogoController);
    </script>
  </body>
</html>
